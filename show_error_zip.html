<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>資料表格顯示</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.1.0/pako.min.js"></script>
<style>
  body {
    margin:0; font-family: Arial, sans-serif; background:#0078d7; display:flex; justify-content:center; align-items:center; min-height:100vh;
    color:#222;
  }
  .container {
    background:#fff; border-radius:12px; padding:30px 40px; max-width:1000px; width:90%; box-shadow:0 6px 20px rgba(0,0,0,0.08);
  }
  h1 { text-align:center; color:#0078d7; margin-bottom:20px; }
  table { width:100%; border-collapse:collapse; font-size:14px; }
  th, td { padding:10px 12px; border-bottom:1px solid #eee; text-align:left; }
  th { background:#f9f9fc; cursor:pointer; position:sticky; top:0; }
  tr:hover td { background:#f4f8ff; }
  .empty { text-align:center; padding:40px; color:#666; font-size:15px; }
</style>
</head>
<body>
<div class="container">
  <h1>資料表格顯示</h1>
  <div id="table-wrap"></div>
</div>

<script>
function renderTable(data){
    const wrap=document.getElementById('table-wrap');
    if(!data || !data.length){ wrap.innerHTML='<div class="empty">無資料</div>'; return; }

    const headers=Object.keys(data[0]);
    const table=document.createElement('table');

    const thead=document.createElement('thead');
    const trh=document.createElement('tr');
    headers.forEach((h,idx)=>{
        const th=document.createElement('th'); th.textContent=h;
        th.addEventListener('click', ()=>sortByColumn(idx));
        trh.appendChild(th);
    });
    thead.appendChild(trh);
    table.appendChild(thead);

    const tbody=document.createElement('tbody');
    data.forEach(r=>{
        const tr=document.createElement('tr');
        headers.forEach(h=>{
            const td=document.createElement('td'); td.textContent=r[h]??'';
            tr.appendChild(td);
        });
        tbody.appendChild(tr);
    });
    table.appendChild(tbody);
    wrap.innerHTML=''; wrap.appendChild(table);

    let sortCol=null, sortAsc=true;
    function sortByColumn(idx){
        const col=headers[idx];
        if(sortCol===col) sortAsc=!sortAsc; else { sortCol=col; sortAsc=true; }
        data.sort((a,b)=>{
            const A=a[col]??'', B=b[col]??'';
            const nA=parseFloat(A), nB=parseFloat(B);
            if(!isNaN(nA) && !isNaN(nB)) return sortAsc? nA-nB : nB-nA;
            return sortAsc? String(A).localeCompare(String(B)) : String(B).localeCompare(String(A));
        });
        renderTable(data);
    }
}

// 解析 URL 中 data 參數
function getDataFromURL(){
    const params = new URLSearchParams(window.location.search);
    let dataStr = params.get('data');
    if(!dataStr) return null;

    // URL-safe Base64 -> 標準 Base64
    dataStr = dataStr.replace(/-/g,'+').replace(/_/g,'/');
    while(dataStr.length % 4) dataStr += '=';

    try{
        const compressed = Uint8Array.from(atob(decodeURIComponent(dataStr)), c=>c.charCodeAt(0));
        const jsonStr = pako.ungzip(compressed,{to:'string'});
        return JSON.parse(jsonStr);
    } catch(e){
        console.error("解壓縮失敗:", e);
        return null;
    }
}

const tableData = getDataFromURL();
renderTable(tableData);
</script>
</body>
</html>
